<?php
/**
* @file programformpage.php
* Purpose: setup programmer pages
* Extends MainPage Class
*
* @author Keith Gudger
* @copyright  (c) 2019, Keith Gudger, all rights reserved
* @license    http://opensource.org/licenses/BSD-2-Clause
* @version    Release: 1.0
* @package    KSQD
*
* @note Has processData and showContent, 
* main and checkForm in MainPage class not overwritten.
* 
*/
/* /var/www/html/wp-content/plugins/programform/includes */
require_once("/var/www/html/wp-content/plugins/programform/includes/mainpage.php");
include_once "/var/www/html/includes/util.php";

/**
 * Child class of MainPage used for user preferrences page.
 *
 * Implements processData and showContent
 */

class pFormPage extends MainPage {

/**
 * Process the data and insert / modify database.
 *
 * @param $uid is user id passed by reference.
 */
function processData(&$uid) {
  $uid = array();
  $uid['show_id'] = $this->formL->getValue("showid");
  $uid['rss_feed'] = $this->formL->getValue("rssfeed");
  $uid['show_blog'] = $this->formL->getValue("showblog");
    // Process the verified data here.
}

/**
 * Display the content of the page.
 *
 * @param $title is page title.
 * @param $uid is user id passed by reference.
 */
function showContent($title, &$uid) {

// Put HTML after the closing PHP tag
?>
<div class="preamble" id="KSQD-preamble" role="article">
<?php
  $show_list = get_shows(200);
  $rss_feed  = array();
  $rss_feed['None'] = '';
  $sql = "SELECT wp_terms.name, wp_terms.slug 
		FROM wp_terms,wp_term_taxonomy 
		WHERE wp_term_taxonomy.taxonomy = 'series' 
		AND wp_term_taxonomy.term_taxonomy_id = wp_terms.term_id";
  $result = $this->db->query($sql);
  while ($row = $result->fetch(PDO::FETCH_ASSOC)) {
    $rss_feed[$row["name"]] = $row["slug"];
  }

  $blog_id = array();
  $blog_id['None'] = '';
  $sql = "SELECT post_title FROM `wp_posts` 
		WHERE post_type = 'pt_view'";
  $result = $this->db->query($sql);
  while ($row = $result->fetch(PDO::FETCH_ASSOC)) {
    $temp = $row['post_title'];
    $temp_split = explode(' [ID: ',$temp); // 0 is name, 1 is ID
    $temp_split[1] = substr($temp_split[1], 0, -1); // removes ']' from ID
    $blog_id[$temp_split[0]] = $temp_split[1];
  }
	echo $this->formL->reportErrors();
	echo $this->formL->start('POST', "", 'name="programform"');
?>
<fieldset>
<legend>Please the show name and RSS feed name (if exists).</legend
<br>
<?php
// makeNumberInput($name,$min="",$max="", $value="",$other="")
  echo $this->formL->formatOnError('showid','Show Name: ') ;
  echo $this->formL->makeSelect('showid',$show_list,"") . "<br>";
  echo $this->formL->formatOnError('rssfeed','Show Rss Feed: ') ;
  echo $this->formL->makeSelect('rssfeed',$rss_feed,"") . "<br>";
  echo $this->formL->formatOnError('showblog','Show Blog: ') ;
  echo $this->formL->makeSelect('showblog',$blog_id,"") . "<br>";?>
<input class="subbutton" type="submit" name="Submit" value="Submit">
</fieldset>
</form>
<?php
/*  if ( $uid[0] >= 0 ) {
    switch ($uid[0]) {
      case $radiolist["Name"]: // Name
         $this->nameTable($uid[1],$uid[2]);
       break;
      case $radiolist["Total Amount"]: // Amount 
         $this->amountTable($uid[1],$uid[2]);
       break;
      case $radiolist["Date"]: // Date
         $this->dateTable($uid[1],$uid[2]);
       break;
      case $radiolist["Category"]: 
         $this->categoryTable($uid[1],$uid[2]);
       break;
      case $radiolist["Item"]: 
         $this->itemTable($uid[1],$uid[2]);
       break;
      case $radiolist["Location"]: 
         $this->locationTable($uid[1],$uid[2]);
       break;
      default:
        echo $uid[0];
    } 
  }
  else echo "No sort selected.";
*/
//  echo ($this->formL->getValue("getFile")[0]);
?>

<?php
$this->formL->finish();
$show_logo_array = get_playlist($uid['show_id']);
$show_logo = $show_logo_array['showlogo'];
$rss_feed_url = $uid['rss_feed'];
$rss_feed_name = array_search($rss_feed_url, $rss_feed); // find name for slug
$show_blog_id = $uid['show_blog']; // ID
echo "ID is " . $show_blog_id;
$pagedata = <<<EOT
			<div class="et_pb_extra_column_main">
				<div class="et_pb_extra_row">
					<div class="et_pb_extra_column et_pb_extra_column_4_4">
											<article id="post-1991" class="module post-1991 page type-page status-publish has-post-thumbnail hentry">
							<div class="post-wrap">
								<h1><a href="https://ksqd.org/state-of-mind/">State of Mind</a></h1>
								<div class="post-content">
									<div id="et-boc" class="et-boc">
			
			<div class="et_builder_inner_content et_pb_gutters3"><div class="et_pb_section et_pb_section_0 et_section_regular">
				
				
				
				
					<div class="et_pb_row et_pb_row_0">
				<div class="et_pb_column et_pb_column_2_5 et_pb_column_0    et_pb_css_mix_blend_mode_passthrough">
				
				
				<div class="et_pb_module et_pb_image et_pb_image_0">
				
				
				<span class="et_pb_image_wrap "><img src="$show_logo" alt="" /></span>
			</div>
			</div> <!-- .et_pb_column --><div class="et_pb_column et_pb_column_3_5 et_pb_column_1    et_pb_css_mix_blend_mode_passthrough">
				
				
				<div class="et_pb_module et_pb_testimonial et_pb_testimonial_0 clearfix et_pb_bg_layout_light  et_pb_text_align_left et_pb_testimonial_no_image">
				
				
				
				<div class="et_pb_testimonial_description">
					<div class="et_pb_testimonial_description_inner">
					Being human, and living well.
					<span class="et_pb_testimonial_author"></span>
					<p class="et_pb_testimonial_meta"></p>
					</div> <!-- .et_pb_testimonial_description_inner -->
				</div> <!-- .et_pb_testimonial_description -->
			</div> <!-- .et_pb_testimonial --><div class="et_pb_module et_pb_text et_pb_text_0 et_pb_bg_layout_light  et_pb_text_align_left">
				
				
				<div class="et_pb_text_inner">
					<p>Hosted by <strong>Debra Sloss LMFT</strong><br />Co-produced by <strong>Debra Sloss, LMFT &amp; Lauren Fein, LMFT</strong></p>
<p>Show Type: Prerecorded Interview/Talk Show</p>
				</div>
			</div> <!-- .et_pb_text -->
			</div> <!-- .et_pb_column -->
				
				
			</div> <!-- .et_pb_row --><div class="et_pb_row et_pb_row_1">
				<div class="et_pb_column et_pb_column_2_3 et_pb_column_2    et_pb_css_mix_blend_mode_passthrough">
				
				
				<div class="et_pb_module et_pb_text et_pb_text_1 et_pb_bg_layout_light  et_pb_text_align_left">
				
				
				<div class="et_pb_text_inner">
					State of Mind is hosted by Debra Sloss, Licensed Marriage &#038; Family Therapist and features intimate conversations about mental health and wellness here on the central coast of California. Shows air monthly, on the first Sunday of the month from 6-7 PM. In each show, guests share their very personal stories and their clinical expertise on a specific mental health topic. So join us for new understandings, seeds of hope and learn about local resources. This is a unique opportunity to hear the hard-earned wisdom that only comes from lived experience,  </p>
<p>We at State of Mind believe that in airing these stories we bring to light the complexity of the human experience, we help reduce stigma, provide important education and improve access to care and support; all with the hope that doing so will lead to changing attitudes, more compassion and improved policy making. </p>
<p>To sum it up…. we’re trying to help our world become a little more humane, one remarkable story of recovery at a time!  
				</div>
			</div> <!-- .et_pb_text -->
			</div> <!-- .et_pb_column --><div class="et_pb_column et_pb_column_1_3 et_pb_column_3    et_pb_css_mix_blend_mode_passthrough">
				
				
				<div class="et_pb_module et_pb_text et_pb_text_2 et_pb_bg_layout_light  et_pb_text_align_left">
				
				
				<div class="et_pb_text_inner">
					<h3>Podcasts/Show Archives</h3>
<hr />
<p><a href="https://ksqd.org/feed/podcast/$rss_feed_url">$rss_feed_name &#8211; Podcast RSS Feed</a>
				</div>
			</div> <!-- .et_pb_text --><div class="et_pb_module et_pb_code et_pb_code_0">
				
				
				<div class="et_pb_code_inner">
					<div class="pt-cv-wrapper et_smooth_scroll_disabled"><a href="https://ksqd.org/wp-admin/admin.php?page=content-views-add&#038;id=$show_blog_id" target="_blank" class="pt-cv-edit-view">Edit View</a><br><div class="pt-cv-view pt-cv-collapsible pt-cv-sharp-buttons" id="pt-cv-view-ec9ee30cfz"><div data-id="pt-cv-page-1" class="pt-cv-page" data-cvc="1"><div class="panel-group" id="402bb12g7e"><div class="panel panel-default pt-cv-content-item pt-cv-1-col"  data-pid="5371">
<div class="panel-heading">
	<a class="panel-title" data-toggle="cvcollapse" data-parent="#402bb12g7e" href="#77f672atjs">
		STATE OF MIND &#8211; Suicide &amp; Grief: A Story of Hope remix	</a>
	<span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-plus"></i></span></div>
<div id="77f672atjs" class="panel-collapse collapse ">
	<div class="panel-body">
		<a href="https://ksqd.org/state-of-mind-grief-suicide-a-story-of-hope-remix/" class="_blank pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_blank" ><img width="150" height="77" src="https://ksqd.org/wp-content/uploads/2018/11/FINAL-PHOTO-Collage-wnames-1.jpeg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Suicide &amp; Grief: A Story of Hope remix" /></a>
<div class="pt-cv-content">Episode #7: In this STATE OF MIND episode (remixed for broadcast) Debra Sloss, LMFT is joined by guests Rabbi Lori ...<br /><a href="https://ksqd.org/state-of-mind-grief-suicide-a-story-of-hope-remix/" class="_blank pt-cv-readmore btn btn-success cvplbd" target="_blank" >Read More</a></div>	</div>
</div></div>
<div class="panel panel-default pt-cv-content-item pt-cv-1-col"  data-pid="5120">
<div class="panel-heading">
	<a class="panel-title" data-toggle="cvcollapse" data-parent="#402bb12g7e" href="#46ac686knj">
		STATE OF MIND &#8211; Dual Diagnoses: The Challenges of Recovery	</a>
	<span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-plus"></i></span></div>
<div id="46ac686knj" class="panel-collapse collapse ">
	<div class="panel-body">
		<a href="https://ksqd.org/state-of-mind-dual-diagnoses-the-challenges-of-recovery/" class="_blank pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_blank" ><img width="150" height="92" src="https://ksqd.org/wp-content/uploads/2019/05/DD-headshot-collage2.jpg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Dual Diagnoses: The Challenges of Recovery" /></a>
<div class="pt-cv-content">Episode #6: In this STATE OF MIND episode Debra Sloss, LMFT is joined by guests Cynthia Nollenberger, LMFT &amp; Rick ...<br /><a href="https://ksqd.org/state-of-mind-dual-diagnoses-the-challenges-of-recovery/" class="_blank pt-cv-readmore btn btn-success cvplbd" target="_blank" >Read More</a></div>	</div>
</div></div>
<div class="panel panel-default pt-cv-content-item pt-cv-1-col"  data-pid="4799">
<div class="panel-heading">
	<a class="panel-title" data-toggle="cvcollapse" data-parent="#402bb12g7e" href="#3d4addap3d">
		STATE OF MIND &#8211; Recovery from Serious Mental Illness &amp; NAMI	</a>
	<span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-plus"></i></span></div>
<div id="3d4addap3d" class="panel-collapse collapse ">
	<div class="panel-body">
		<a href="https://ksqd.org/state-of-mind-recovery-from-serious-mental-illness-nami/" class="_blank pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_blank" ><img width="150" height="113" src="https://ksqd.org/wp-content/uploads/2019/04/IMG_6797.jpg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Recovery from Serious Mental Illness &amp; NAMI" /></a>
<div class="pt-cv-content">Episode #5: In this STATE OF MIND episode Debra Sloss, LMFT is joined by peer &amp; NAMI educator Hugh McCormick ...<br /><a href="https://ksqd.org/state-of-mind-recovery-from-serious-mental-illness-nami/" class="_blank pt-cv-readmore btn btn-success cvplbd" target="_blank" >Read More</a></div>	</div>
</div></div>
<div class="panel panel-default pt-cv-content-item pt-cv-1-col"  data-pid="4513">
<div class="panel-heading">
	<a class="panel-title" data-toggle="cvcollapse" data-parent="#402bb12g7e" href="#3dfacd1ri2">
		STATE OF MIND &#8211; Empowerment and Healing through Self-Defense	</a>
	<span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-plus"></i></span></div>
<div id="3dfacd1ri2" class="panel-collapse collapse ">
	<div class="panel-body">
		<a href="https://ksqd.org/state-of-mind-empowerment-and-healing-through-self-defense/" class="_blank pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_blank" ><img width="150" height="100" src="https://ksqd.org/wp-content/uploads/2019/03/Headshot-collage-WSD.jpeg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Empowerment and Healing through Self-Defense" /></a>
<div class="pt-cv-content">Episode #4: In this STATE OF MIND episode Debra Sloss, LMFT is joined by Toni Crossen, LMFT and Denise Leto ...<br /><a href="https://ksqd.org/state-of-mind-empowerment-and-healing-through-self-defense/" class="_blank pt-cv-readmore btn btn-success cvplbd" target="_blank" >Read More</a></div>	</div>
</div></div>
<div class="panel panel-default pt-cv-content-item pt-cv-1-col"  data-pid="4099">
<div class="panel-heading">
	<a class="panel-title" data-toggle="cvcollapse" data-parent="#402bb12g7e" href="#3cc60b7x6q">
		STATE OF MIND &#8211; Parenting Transgender Youth	</a>
	<span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-plus"></i></span></div>
<div id="3cc60b7x6q" class="panel-collapse collapse ">
	<div class="panel-body">
		<a href="https://ksqd.org/parenting-transgender-youth/" class="_blank pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_blank" ><img width="150" height="113" src="https://ksqd.org/wp-content/uploads/2019/02/somtg.png" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Parenting Transgender Youth" /></a>
<div class="pt-cv-content">Episode # 3: In this STATE OF MIND episode Debra Sloss, LMFT is joined by parent advocate Heidi Korokowski and gender ...<br /><a href="https://ksqd.org/parenting-transgender-youth/" class="_blank pt-cv-readmore btn btn-success cvplbd" target="_blank" >Read More</a></div>	</div>
</div></div>
<div class="panel panel-default pt-cv-content-item pt-cv-1-col"  data-pid="2283">
<div class="panel-heading">
	<a class="panel-title" data-toggle="cvcollapse" data-parent="#402bb12g7e" href="#5d9c4e2ew7">
		STATE OF MIND &#8211; Suicide and Grief: A Story of Hope	</a>
	<span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-plus"></i></span></div>
<div id="5d9c4e2ew7" class="panel-collapse collapse ">
	<div class="panel-body">
		<a href="https://ksqd.org/state-of-mind-suicide-and-grief-a-story-of-hope/" class="_blank pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_blank" ><img width="150" height="77" src="https://ksqd.org/wp-content/uploads/2018/11/FINAL-PHOTO-Collage-wnames-1.jpeg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Suicide and Grief: A Story of Hope" /></a>
<div class="pt-cv-content">Episode #2: In this STATE OF MIND episode Debra Sloss, LMFT is joined by guests Rabbi Lori Klein and Kara ...<br /><a href="https://ksqd.org/state-of-mind-suicide-and-grief-a-story-of-hope/" class="_blank pt-cv-readmore btn btn-success cvplbd" target="_blank" >Read More</a></div>	</div>
</div></div>
<div class="panel panel-default pt-cv-content-item pt-cv-1-col"  data-pid="1996">
<div class="panel-heading">
	<a class="panel-title" data-toggle="cvcollapse" data-parent="#402bb12g7e" href="#7701f68up3">
		STATE OF MIND &#8211; Understanding Adult ADHD	</a>
	<span class="pull-right clickable panel-collapsed"><i class="glyphicon glyphicon-plus"></i></span></div>
<div id="7701f68up3" class="panel-collapse collapse ">
	<div class="panel-body">
		<a href="https://ksqd.org/state-of-mind-adult-adhd/" class="_blank pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_blank" ><img width="150" height="113" src="https://ksqd.org/wp-content/uploads/2018/10/IMG_6360.jpg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Understanding Adult ADHD" /></a>
<div class="pt-cv-content">Episode #1: Welcome to the very fist episode of “STATE OF MIND: Being Human and Living Well” soon to broadcast ...<br /><a href="https://ksqd.org/state-of-mind-adult-adhd/" class="_blank pt-cv-readmore btn btn-success cvplbd" target="_blank" >Read More</a></div>	</div>
</div></div></div></div></div></div>			<style type="text/css" id="pt-cv-inline-style-29517a2m84">#pt-cv-view-ec9ee30cfz.pt-cv-post-border { margin: 0; border-top-width: 1px; border-left-width: 1px }
#pt-cv-view-ec9ee30cfz.pt-cv-post-border { margin: 0; border-top-style: solid; border-left-style: solid }
#pt-cv-view-ec9ee30cfz.pt-cv-post-border .pt-cv-content-item   { border-right-width: 1px; border-bottom-width: 1px; border-right-style: solid; border-bottom-style: solid; }
#pt-cv-view-ec9ee30cfz .pt-cv-title a, #pt-cv-view-ec9ee30cfz  .panel-title { font-weight: 600 !important; }
#pt-cv-view-ec9ee30cfz  .pt-cv-hover-wrapper::before   { background-color: rgba(0,0,0,.3) !important; }
#pt-cv-view-ec9ee30cfz  .pt-cv-content-item:hover .pt-cv-hover-wrapper::before   { background-color: rgba(51,51,51,.6) !important; }
#pt-cv-view-ec9ee30cfz:not(.pt-cv-nohover) .pt-cv-mask *   { color: #fff; }
#pt-cv-view-ec9ee30cfz .pt-cv-carousel-caption  { background-color: rgba(51,51,51,.6) !important; }
#pt-cv-view-ec9ee30cfz .pt-cv-specialp { background-color: #CC3333 !important }
#pt-cv-view-ec9ee30cfz .pt-cv-specialp * { color: #fff !important; }
#pt-cv-view-ec9ee30cfz .pt-cv-pficon  { color: #bbb !important; }
#pt-cv-view-ec9ee30cfz  .add_to_cart_button, #pt-cv-view-ec9ee30cfz  .add_to_cart_button *   { color: #ffffff !important; background-color: #00aeef !important; }
#pt-cv-view-ec9ee30cfz  .woocommerce-onsale   { color: #ffffff !important; background-color: #ff5a5f !important; }
#pt-cv-view-ec9ee30cfz .pt-cv-readmore  { color: #ffffff !important; background-color: #00aeef !important; }
#pt-cv-view-ec9ee30cfz .pt-cv-readmore:hover  { color: #ffffff !important; background-color: #00aeef !important; }
#pt-cv-view-ec9ee30cfz  + .pt-cv-pagination-wrapper .pt-cv-more , #pt-cv-view-ec9ee30cfz  + .pt-cv-pagination-wrapper .pagination .active a { color: #ffffff !important; background-color: #00aeef !important; }
[id^='pt-cv-filter-bar-ec9ee30cfz'] .active.pt-cv-filter-option, [id^='pt-cv-filter-bar-ec9ee30cfz'] .active .pt-cv-filter-option, [id^='pt-cv-filter-bar-ec9ee30cfz'] .selected.pt-cv-filter-option, [id^='pt-cv-filter-bar-ec9ee30cfz'] .dropdown-toggle   { color: #fff !important; background-color: #00aeef !important; }
[id^='pt-cv-filter-bar-ec9ee30cfz'] .pt-cv-filter-title   { color: #fff !important; background-color: #00aeef !important; }
#pt-cv-gls-ec9ee30cfz li a.pt-active   { color: #fff !important; background-color: #ff5a5f !important; }
#pt-cv-view-ec9ee30cfz .pt-cv-gls-header  { color: #fff !important; background-color: #00aeef !important; }</style>
			
				</div> <!-- .et_pb_code_inner -->
			</div> <!-- .et_pb_code -->
			</div> <!-- .et_pb_column -->
				
				
			</div> <!-- .et_pb_row --><div class="et_pb_row et_pb_row_2">
				<div class="et_pb_column et_pb_column_4_4 et_pb_column_4    et_pb_css_mix_blend_mode_passthrough et-last-child">
				
				
				<div class="et_pb_module et_pb_code et_pb_code_1">
				
				
				<div class="et_pb_code_inner">
					<iframe width="800" height="800" src="https://widgets.spinitron.com/KSQD/show/159893/State-of-Mind-Faith-Matters"></iframe>
				</div> <!-- .et_pb_code_inner -->
			</div> <!-- .et_pb_code --><div class="et_pb_module et_pb_text et_pb_text_3 et_pb_bg_layout_light  et_pb_text_align_left">
				
				
				<div class="et_pb_text_inner">
					<h2>Blog Posts/Show Updates</h2>
				</div>
			</div> <!-- .et_pb_text --><div class="et_pb_module et_pb_code et_pb_code_2">
				
				
				<div class="et_pb_code_inner">
					<div class="pt-cv-wrapper et_smooth_scroll_disabled"><a href="https://ksqd.org/wp-admin/admin.php?page=content-views-add&#038;id=f2a8a9b6sz" target="_blank" class="pt-cv-edit-view">Edit View</a><br><div class="pt-cv-view pt-cv-grid pt-cv-colsys pt-cv-sharp-buttons" id="pt-cv-view-f2a8a9b6sz"><div data-id="pt-cv-page-1" class="pt-cv-page" data-cvc="2"><div class="col-md-6 col-sm-6 col-xs-12 pt-cv-content-item pt-cv-1-col"  data-pid="5371"><div class='pt-cv-ifield'><a href="https://ksqd.org/state-of-mind-grief-suicide-a-story-of-hope-remix/" class="_self pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_self" ><img width="400" height="205" src="https://ksqd.org/wp-content/uploads/2018/11/FINAL-PHOTO-Collage-wnames-1.jpeg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Suicide &amp; Grief: A Story of Hope remix" /></a>
<h4 class="pt-cv-title"><a href="https://ksqd.org/state-of-mind-grief-suicide-a-story-of-hope-remix/" class="_self cvplbd" target="_self" >STATE OF MIND &#8211; Suicide &amp; Grief: A Story of Hope remix</a></h4>
<div class="pt-cv-content">Episode #7: In this STATE OF MIND episode (remixed for broadcast) Debra Sloss, LMFT is joined by guests Rabbi Lori ...<br /><a href="https://ksqd.org/state-of-mind-grief-suicide-a-story-of-hope-remix/" class="_self pt-cv-readmore btn btn-success cvplbd" target="_self" >Read More</a></div></div></div>
<div class="col-md-6 col-sm-6 col-xs-12 pt-cv-content-item pt-cv-1-col"  data-pid="5120"><div class='pt-cv-ifield'><a href="https://ksqd.org/state-of-mind-dual-diagnoses-the-challenges-of-recovery/" class="_self pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_self" ><img width="400" height="245" src="https://ksqd.org/wp-content/uploads/2019/05/DD-headshot-collage2.jpg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Dual Diagnoses: The Challenges of Recovery" /></a>
<h4 class="pt-cv-title"><a href="https://ksqd.org/state-of-mind-dual-diagnoses-the-challenges-of-recovery/" class="_self cvplbd" target="_self" >STATE OF MIND &#8211; Dual Diagnoses: The Challenges of Recovery</a></h4>
<div class="pt-cv-content">Episode #6: In this STATE OF MIND episode Debra Sloss, LMFT is joined by guests Cynthia Nollenberger, LMFT &amp; Rick ...<br /><a href="https://ksqd.org/state-of-mind-dual-diagnoses-the-challenges-of-recovery/" class="_self pt-cv-readmore btn btn-success cvplbd" target="_self" >Read More</a></div></div></div>
<div class="col-md-6 col-sm-6 col-xs-12 pt-cv-content-item pt-cv-1-col"  data-pid="4799"><div class='pt-cv-ifield'><a href="https://ksqd.org/state-of-mind-recovery-from-serious-mental-illness-nami/" class="_self pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_self" ><img width="400" height="301" src="https://ksqd.org/wp-content/uploads/2019/04/IMG_6797.jpg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Recovery from Serious Mental Illness &amp; NAMI" /></a>
<h4 class="pt-cv-title"><a href="https://ksqd.org/state-of-mind-recovery-from-serious-mental-illness-nami/" class="_self cvplbd" target="_self" >STATE OF MIND &#8211; Recovery from Serious Mental Illness &amp; NAMI</a></h4>
<div class="pt-cv-content">Episode #5: In this STATE OF MIND episode Debra Sloss, LMFT is joined by peer &amp; NAMI educator Hugh McCormick ...<br /><a href="https://ksqd.org/state-of-mind-recovery-from-serious-mental-illness-nami/" class="_self pt-cv-readmore btn btn-success cvplbd" target="_self" >Read More</a></div></div></div>
<div class="col-md-6 col-sm-6 col-xs-12 pt-cv-content-item pt-cv-1-col"  data-pid="4513"><div class='pt-cv-ifield'><a href="https://ksqd.org/state-of-mind-empowerment-and-healing-through-self-defense/" class="_self pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_self" ><img width="400" height="267" src="https://ksqd.org/wp-content/uploads/2019/03/Headshot-collage-WSD.jpeg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Empowerment and Healing through Self-Defense" /></a>
<h4 class="pt-cv-title"><a href="https://ksqd.org/state-of-mind-empowerment-and-healing-through-self-defense/" class="_self cvplbd" target="_self" >STATE OF MIND &#8211; Empowerment and Healing through Self-Defense</a></h4>
<div class="pt-cv-content">Episode #4: In this STATE OF MIND episode Debra Sloss, LMFT is joined by Toni Crossen, LMFT and Denise Leto ...<br /><a href="https://ksqd.org/state-of-mind-empowerment-and-healing-through-self-defense/" class="_self pt-cv-readmore btn btn-success cvplbd" target="_self" >Read More</a></div></div></div>
<div class="col-md-6 col-sm-6 col-xs-12 pt-cv-content-item pt-cv-1-col"  data-pid="4099"><div class='pt-cv-ifield'><a href="https://ksqd.org/parenting-transgender-youth/" class="_self pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_self" ><img width="400" height="301" src="https://ksqd.org/wp-content/uploads/2019/02/somtg.png" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Parenting Transgender Youth" /></a>
<h4 class="pt-cv-title"><a href="https://ksqd.org/parenting-transgender-youth/" class="_self cvplbd" target="_self" >STATE OF MIND &#8211; Parenting Transgender Youth</a></h4>
<div class="pt-cv-content">Episode # 3: In this STATE OF MIND episode Debra Sloss, LMFT is joined by parent advocate Heidi Korokowski and gender ...<br /><a href="https://ksqd.org/parenting-transgender-youth/" class="_self pt-cv-readmore btn btn-success cvplbd" target="_self" >Read More</a></div></div></div>
<div class="col-md-6 col-sm-6 col-xs-12 pt-cv-content-item pt-cv-1-col"  data-pid="2283"><div class='pt-cv-ifield'><a href="https://ksqd.org/state-of-mind-suicide-and-grief-a-story-of-hope/" class="_self pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_self" ><img width="400" height="205" src="https://ksqd.org/wp-content/uploads/2018/11/FINAL-PHOTO-Collage-wnames-1.jpeg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Suicide and Grief: A Story of Hope" /></a>
<h4 class="pt-cv-title"><a href="https://ksqd.org/state-of-mind-suicide-and-grief-a-story-of-hope/" class="_self cvplbd" target="_self" >STATE OF MIND &#8211; Suicide and Grief: A Story of Hope</a></h4>
<div class="pt-cv-content">Episode #2: In this STATE OF MIND episode Debra Sloss, LMFT is joined by guests Rabbi Lori Klein and Kara ...<br /><a href="https://ksqd.org/state-of-mind-suicide-and-grief-a-story-of-hope/" class="_self pt-cv-readmore btn btn-success cvplbd" target="_self" >Read More</a></div></div></div>
<div class="col-md-6 col-sm-6 col-xs-12 pt-cv-content-item pt-cv-1-col"  data-pid="1996"><div class='pt-cv-ifield'><a href="https://ksqd.org/state-of-mind-adult-adhd/" class="_self pt-cv-href-thumbnail pt-cv-thumb-default cvplbd" target="_self" ><img width="400" height="301" src="https://ksqd.org/wp-content/uploads/2018/10/IMG_6360.jpg" class="pt-cv-thumbnail img-none" alt="STATE OF MIND - Understanding Adult ADHD" /></a>
<h4 class="pt-cv-title"><a href="https://ksqd.org/state-of-mind-adult-adhd/" class="_self cvplbd" target="_self" >STATE OF MIND &#8211; Understanding Adult ADHD</a></h4>
<div class="pt-cv-content">Episode #1: Welcome to the very fist episode of “STATE OF MIND: Being Human and Living Well” soon to broadcast ...<br /><a href="https://ksqd.org/state-of-mind-adult-adhd/" class="_self pt-cv-readmore btn btn-success cvplbd" target="_self" >Read More</a></div></div></div></div></div></div>			<style type="text/css" id="pt-cv-inline-style-c4cb92d6y8">#pt-cv-view-f2a8a9b6sz.pt-cv-post-border { margin: 0; border-top-width: 1px; border-left-width: 1px }
#pt-cv-view-f2a8a9b6sz.pt-cv-post-border { margin: 0; border-top-style: solid; border-left-style: solid }
#pt-cv-view-f2a8a9b6sz.pt-cv-post-border .pt-cv-content-item   { border-right-width: 1px; border-bottom-width: 1px; border-right-style: solid; border-bottom-style: solid; }
#pt-cv-view-f2a8a9b6sz .pt-cv-title a, #pt-cv-view-f2a8a9b6sz  .panel-title { font-weight: 600 !important; }
#pt-cv-view-f2a8a9b6sz  .pt-cv-hover-wrapper::before   { background-color: rgba(0,0,0,.3) !important; }
#pt-cv-view-f2a8a9b6sz  .pt-cv-content-item:hover .pt-cv-hover-wrapper::before   { background-color: rgba(51,51,51,.6) !important; }
#pt-cv-view-f2a8a9b6sz:not(.pt-cv-nohover) .pt-cv-mask *   { color: #fff; }
#pt-cv-view-f2a8a9b6sz .pt-cv-carousel-caption  { background-color: rgba(51,51,51,.6) !important; }
#pt-cv-view-f2a8a9b6sz .pt-cv-specialp { background-color: #CC3333 !important }
#pt-cv-view-f2a8a9b6sz .pt-cv-specialp * { color: #fff !important; }
#pt-cv-view-f2a8a9b6sz .pt-cv-pficon  { color: #bbb !important; }
#pt-cv-view-f2a8a9b6sz  .add_to_cart_button, #pt-cv-view-f2a8a9b6sz  .add_to_cart_button *   { color: #ffffff !important; background-color: #00aeef !important; }
#pt-cv-view-f2a8a9b6sz  .woocommerce-onsale   { color: #ffffff !important; background-color: #ff5a5f !important; }
#pt-cv-view-f2a8a9b6sz .pt-cv-readmore  { color: #ffffff !important; background-color: #00aeef !important; }
#pt-cv-view-f2a8a9b6sz .pt-cv-readmore:hover  { color: #ffffff !important; background-color: #00aeef !important; }
#pt-cv-view-f2a8a9b6sz  + .pt-cv-pagination-wrapper .pt-cv-more , #pt-cv-view-f2a8a9b6sz  + .pt-cv-pagination-wrapper .pagination .active a { color: #ffffff !important; background-color: #00aeef !important; }
[id^='pt-cv-filter-bar-f2a8a9b6sz'] .active.pt-cv-filter-option, [id^='pt-cv-filter-bar-f2a8a9b6sz'] .active .pt-cv-filter-option, [id^='pt-cv-filter-bar-f2a8a9b6sz'] .selected.pt-cv-filter-option, [id^='pt-cv-filter-bar-f2a8a9b6sz'] .dropdown-toggle   { color: #fff !important; background-color: #00aeef !important; }
[id^='pt-cv-filter-bar-f2a8a9b6sz'] .pt-cv-filter-title   { color: #fff !important; background-color: #00aeef !important; }
#pt-cv-gls-f2a8a9b6sz li a.pt-active   { color: #fff !important; background-color: #ff5a5f !important; }
#pt-cv-view-f2a8a9b6sz .pt-cv-gls-header  { color: #fff !important; background-color: #00aeef !important; }</style>
			
				</div> <!-- .et_pb_code_inner -->
			</div> <!-- .et_pb_code -->
			</div> <!-- .et_pb_column -->
				
				
			</div> <!-- .et_pb_row -->
				
				
			</div> <!-- .et_pb_section -->			</div>
			
		</div>																	</div>
							</div><!-- /.post-wrap -->
						</article>
					</div> <!-- /.et_pb_extra_column_1_1 -->
				</div><!-- /.et_pb_extra_row -->

				
				<div class="authors" data-columns>
																		<div class="author" style="border-top-color:#007569">
								<style type="text/css">
									.et-extra-icon-author-42-color-hover:hover::before {
										color: #007569 !important;
									}
								</style>
								<div class="author-content">
									<a href="https://ksqd.org/author/dsloss/" title="Posts By: Debra Sloss" rel="author">
										<img alt='Debra Sloss' src='https://secure.gravatar.com/avatar/62c20d6baef78b0be4968e484d917cf7?s=150&#038;d=mm&#038;r=pg' srcset='https://secure.gravatar.com/avatar/62c20d6baef78b0be4968e484d917cf7?s=300&#038;d=mm&#038;r=pg 2x' class='avatar avatar-150 photo' height='150' width='150' />									</a>
									<h2 style="color:#007569">Debra Sloss</h2>
									<p class="description">Debra Sloss, MA, LMFT is a Licensed Marriage &amp; Family Therapist and host of KSQD&#039;s radio program &quot;STATE OF MIND: Being Human and Living Well.&quot; Programs feature intimate conversations about mental health and wellness here on the central coast of California. In each show Debra interviews two or more guests who share their personal stories and their clinical expertise on a mental health topic. Her programs seek to educate through personal stories of mental health recovery and wellness, and the sharing of resources. While Debra is new to radio, she has over 20 years of experience providing therapy services, as well as more than 10 years of experience as a Clinical Supervisor training and teaching new therapists. She continues to offer counseling and psychotherapy services in her private practice in Santa Cruz, California.</p>
																		<a href="https://ksqd.org/author/dsloss/" class="button post-count" title="Posts By: dsloss" rel="author">7 Posts</a>
								</div> <!-- /.author-content -->

															</div> <!-- /.author -->
									</div>

					
							</div><!-- /.et_pb_extra_column.et_pb_extra_column_main -->
EOT;
if (!empty($uid['show_id'])) 
	echo $pagedata; // which works?
return $pagedata;
}
}
// functions to return needed info from Spinitron

$apiBaseUrl = 'https://spinitron.com/api';
$spin_api_key = 'SZraTfnREXIDBf1jHTO2yqXa';
//$show_id = '101316';

    /**
     * Request resources from an endpoint using search parameters.
     *
     * @see https://spinitron.github.io/v2api for search parameters
     *
     * @param string $endpoint e.g. 'spins', 'shows' ...
     * @param array $params e.g. ['playlist_id' => 1234, 'page' => 2]
     * @return array Response with an array of resources of the endpoint's type plus metadata
     * @throws \Exception
     */
function spin_search($endpoint, $params)
{
   $url = '/' . $endpoint;
   if (!empty($params)) {
       $url .= '?' . http_build_query($params);
   }
   return json_decode(spin_query($endpoint, $url), true);
}

    /**
     * Query the API with the given URL, returning the response JSON document
     * from the API.
     *
     * @param string $endpoint e.g. 'spins', 'shows' ...
     * @param string $url
     * @return string JSON document
     * @throws \Exception
     */
function spin_query($endpoint, $url)
{
   global $spin_api_key;
   global $apiBaseUrl;
   
// Request resource from the API.
    $context = stream_context_create([
        'http' => [
            'user_agent' => 'Mozilla/5.0 Spinitron v2 API demo client',
            'header' => 'Authorization: Bearer ' . 'SZraTfnREXIDBf1jHTO2yqXa',
        ],
    ]);
    
    $fullUrl = 'https://spinitron.com/api' . $url;

    $stream = fopen($fullUrl, 'rb', false, $context);
    if ($stream === false) {
        throw new Exception('Error opening stream for ' . $fullUrl);
    }

    $response = stream_get_contents($stream);
    if ($response === false) {
        throw new Exception('Error requesting ' . $fullUrl . ': ' . var_export(stream_get_meta_data($stream), true));
    }

    return $response;
}

/**
 * get playlist for show
 * @param $show_id is show id
 */
function get_playlist($show_id) {
	$params = array('show_id'=>$show_id); // array for show id
	$play_array = spin_search('playlist', $params);
	$play_items = $play_array['items'][0]; // most recent 1 items
	
	$play_data = array();
	$play_data['showlogo']  = htmlspecialchars($play_items['image'], ENT_NOQUOTES);
	$play_data['title']     = htmlspecialchars($play_items['title'], ENT_NOQUOTES);
	$play_data['persona']   = htmlspecialchars($play_items['persona_id'], ENT_NOQUOTES);
	$play_data['category']  = htmlspecialchars($play_items['category'], ENT_NOQUOTES);

	$playlist = htmlspecialchars($play_items['_links']['spins']['href'], ENT_NOQUOTES);
//	echo "Playlist is . $playlist";
	if (!empty($playlist)) { // playlist_id=8860074&
		$playlist_pos = strpos($playlist,'playlist_id');
		$play_2       = strpos($playlist,'=') + 1; // start of number
		$playlist     = substr($playlist, $play_2);
		$play_data['playlist']  = $playlist;
	} else {
		$play_data['playlist'] = "" ;
	}
	$play_data['description']  = htmlspecialchars($play_items['description'], ENT_NOQUOTES);

	return $play_data;
}

/**
 * get shows
 * @param $count is minimum to return
 */
function get_shows($count=100) {
	$params = array('count'=>$count); // array for show id
	$shows_array = spin_search('shows', $params);
	$shows_data = array();
	
	foreach ($shows_array['items'] as $item) {
		$shows_data[$item['title']] = $item['id'];
	}
	return $shows_data;
}

?>
